import{state as e}from"./constants.js";let statusTimer=null;export const ui={showProgress(e){document.getElementById("progressContainer").style.display="block",document.getElementById("progressFill").style.width=e+"%"},hideProgress(){document.getElementById("progressContainer").style.display="none",document.getElementById("progressFill").style.width="0%"},showStatus(e,t){let n=document.getElementById("statusMessage");n&&(clearTimeout(statusTimer),n.textContent=e,n.className=`status-message status-${t}`,n.style.display="block",statusTimer=setTimeout(()=>{n.style.display="none"},4e3))},openModal(e){let t=document.getElementById(e);t&&(t.style.display="flex")},closeModal(e){let t=document.getElementById(e);t&&(t.style.display="none")},setButtonLoading(e,t,n="处理中..."){let s=document.getElementById(e);if(s){if(t&&!s.dataset.originalContent&&(s.dataset.originalContent=s.innerHTML),t){if(s.disabled=!0,s.classList.add("btn-loading"),"convertBtn"===e){let o=document.getElementById("convertIcon"),l=document.getElementById("convertText");o&&l&&(o.innerHTML='<div class="loading"></div>',l.textContent=n)}else s.innerHTML=`<span class="loading"></span> <span>${n}</span>`}else if(s.disabled=!1,s.classList.remove("btn-loading"),"convertBtn"===e){let a=document.getElementById("convertIcon"),i=document.getElementById("convertText");a&&i&&(a.textContent="\uD83D\uDD04",i.textContent="开始转换")}else s.dataset.originalContent&&(s.innerHTML=s.dataset.originalContent,delete s.dataset.originalContent)}},async withButtonLoading(e,t,n="处理中..."){this.setButtonLoading(e,!0,n);try{await t()}finally{this.setButtonLoading(e,!1)}},scrollToElement(e){let t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth"})},async copyToClipboard(e){try{return await navigator.clipboard.writeText(e),!0}catch(t){return console.error("复制失败:",t),!1}},async goToBestdori(){if(e.currentResult){let t=await this.copyToClipboard(e.currentResult);t&&this.showStatus("JSON 已复制到剪贴板，正在跳转到 Bestdori...","success")}setTimeout(()=>{window.open("https://bestdori.com/community/stories/new","_blank")},500)}};export function initGlobalModalListeners(){window.addEventListener("click",function(e){let t=document.querySelectorAll(".modal");t.forEach(t=>{if(e.target===t){if("costumeModal"===t.id&&window.costumeManager&&window.costumeManager.originalCostumes){window.costumeManager.cancelCostumeChanges();return}ui.closeModal(t.id)}})}),window.addEventListener("keydown",function(e){if("Escape"===e.key){let t=document.querySelectorAll(".modal");t.forEach(e=>{if("none"!==e.style.display){if("costumeModal"===e.id&&window.costumeManager&&window.costumeManager.originalCostumes){window.costumeManager.cancelCostumeChanges();return}ui.closeModal(e.id)}})}})}window.removeConfigItem=function(e){e.parentElement.remove()},window.ui=ui;