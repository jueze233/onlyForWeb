import{state as e}from"./constants.js";import{converter as t}from"./converter.js";export const viewManager={switchView(i){let l=i.target.closest(".view-btn");if(!l){console.error("无法找到 .view-btn 按钮。");return}let s=l.dataset.view,n=document.querySelector(".view-btn.active");n&&n.classList.remove("active"),l.classList.add("active"),document.querySelectorAll(".view-content").forEach(e=>e.classList.remove("active"));let r=document.getElementById(s+"View");r?r.classList.add("active"):console.error(`无法找到视图元素: #${s}View。可能是由于页面翻译工具修改了DOM。`),"split"===s&&(this.syncTextAreas(),this.syncConfigToSplit(),this.syncLive2DToSplit(),e.autoPreviewEnabled&&t.updateSplitPreview())},syncLive2DToSplit(){let t=document.getElementById("splitEnableLive2DCheckbox");t&&(t.checked=e.enableLive2D);let i=document.getElementById("positionConfigBtn");i&&(i.disabled=!e.enableLive2D);let l=document.getElementById("costumeConfigBtn");l&&(l.disabled=!e.enableLive2D)},switchPreviewMode(e){let t=e.target.dataset.mode;document.querySelectorAll(".preview-mode-btn").forEach(e=>e.classList.remove("active")),e.target.classList.add("active"),"json"===t?(document.getElementById("splitPreviewJson").style.display="block",document.getElementById("splitPreviewDialogue").style.display="none"):(document.getElementById("splitPreviewJson").style.display="none",document.getElementById("splitPreviewDialogue").style.display="block")},syncTextAreas(){let e=document.getElementById("inputText").value,t=document.getElementById("splitInputText").value;document.getElementById("classicView").classList.contains("active")?document.getElementById("splitInputText").value=e:document.getElementById("inputText").value=t},syncConfigToSplit(){let e=document.getElementById("narratorName").value;document.getElementById("splitNarratorName").value=e},initializeSplitResizer(){let e=document.getElementById("splitResizer"),t=document.querySelector(".left-panel"),i=document.querySelector(".right-panel"),l=document.querySelector(".split-container");if(!e)return;let s=!1,n=0,r=0;e.addEventListener("mousedown",e=>{s=!0,n=e.clientX,r=t.offsetWidth,document.body.style.cursor="col-resize",document.body.style.userSelect="none",e.preventDefault()}),document.addEventListener("mousemove",a=>{if(!s)return;let o=a.clientX-n,c=l.offsetWidth,d=r+o,u=c-300-e.offsetWidth;if(d>=300&&d<=u){let v=d/c*100,p=100-v-e.offsetWidth/c*100;t.style.flex=`0 0 ${v}%`,i.style.flex=`0 0 ${p}%`}}),document.addEventListener("mouseup",()=>{s&&(s=!1,document.body.style.cursor="",document.body.style.userSelect="")})},formatTextSplit(){let i=document.getElementById("splitInputText"),l=i.value;if(!l.trim()){ui.showStatus("文本内容为空，无需格式化。","info");return}let s=l.split(/\r?\n/),n=s.map(e=>e.trim()).filter(e=>e.length>0),r=n.join("\n\n");i.value=r,ui.showStatus("文本已成功格式化！","success"),e.autoPreviewEnabled&&t.updateSplitPreview()},formatText(){let e=document.getElementById("inputText"),t=e.value;if(!t.trim()){ui.showStatus("文本内容为空，无需格式化。","info");return}let i=t.split(/\r?\n/),l=i.map(e=>e.trim()).filter(e=>e.length>0),s=l.join("\n\n");e.value=s,ui.showStatus("文本已成功格式化！","success")},debouncePreview(){e.autoPreviewEnabled&&(clearTimeout(e.previewDebounceTimer),e.previewDebounceTimer=setTimeout(()=>{t.updateSplitPreview()},500))}};