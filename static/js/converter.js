import{state as e}from"./constants.js";import{ui as t}from"./uiUtils.js";import{quoteManager as r}from"./quoteManager.js";import{dialoguePreview as n}from"./dialoguePreview.js";export const converter={async convertText(){let n=document.getElementById("inputText").value.trim(),o=document.getElementById("narratorName").value||" ";if(!n){t.showStatus("请输入要转换的文本！","error");return}let s=r.getSelectedQuotes();try{t.setButtonLoading("convertBtn",!0,"转换中..."),t.showProgress(10),t.showStatus("正在处理文本...","info");let l=await axios.post("/api/convert",{text:n,narrator_name:o,selected_quote_pairs:s,character_mapping:e.currentConfig,enable_live2d:e.enableLive2D,costume_mapping:e.currentCostumes});t.showProgress(100),e.currentResult=l.data.result,document.getElementById("resultContent").textContent=e.currentResult,Prism.highlightElement(document.getElementById("resultContent")),document.getElementById("resultSection").style.display="block",t.showStatus("转换完成！","success"),t.scrollToElement("resultSection"),setTimeout(()=>t.hideProgress(),1e3)}catch(i){t.showStatus(`转换失败: ${i.response?.data?.error||i.message}`,"error"),t.hideProgress()}finally{t.setButtonLoading("convertBtn",!1)}},async updateSplitPreview(o=!1){let s=document.getElementById("splitInputText").value.trim();if(!s){document.querySelector("#splitPreviewJson code").textContent="// 请输入文本以查看预览",document.getElementById("splitPreviewDialogue").innerHTML='<p style="text-align: center; color: #718096;">请输入文本以查看预览</p>';return}let l=document.getElementById("splitNarratorName").value||" ",i=r.getSelectedQuotes();o&&t.setButtonLoading("splitConvertBtn",!0,"刷新中...");try{let a=await axios.post("/api/convert",{text:s,narrator_name:l,selected_quote_pairs:i,character_mapping:e.currentConfig,enable_live2d:e.enableLive2D,costume_mapping:e.currentCostumes}),u=a.data.result;e.currentResult=u,document.querySelector("#splitPreviewJson code").textContent=u,Prism.highlightElement(document.querySelector("#splitPreviewJson code")),n.updateDialoguePreview(u,"splitPreviewDialogue")}catch(c){let p=`转换失败: ${c.response?.data?.error||c.message}`;document.querySelector("#splitPreviewJson code").textContent=`// ${p}`,document.getElementById("splitPreviewDialogue").innerHTML=`<p style="text-align: center; color: #e53e3e;">${p}</p>`}finally{o&&t.setButtonLoading("splitConvertBtn",!1)}}};