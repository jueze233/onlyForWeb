function performConversion(e){try{let{text:t,config:r}=e,s=processText(t,r);self.postMessage({type:"result",data:s})}catch(a){self.postMessage({type:"error",error:a.message})}}function processText(e,t){let r=e.split("\n"),s=[];return r.forEach(e=>{let r=e.match(/^([\w\s]+)\s*[ï¼š:]\s*(.*)$/);if(r){let[,a,c]=r;s.push({type:"talk",name:a,body:c,characters:t.characterMapping[a]||[]})}}),{actions:s,server:0,voice:"",background:null,bgm:null}}self.addEventListener("message",function(e){let{type:t,data:r}=e.data;switch(t){case"convert":performConversion(r);break;case"batch":performBatchConversion(r)}});