import{state as e}from"./constants.js";import{ui as t,initGlobalModalListeners as n}from"./uiUtils.js";import{viewManager as i}from"./viewManager.js";import{fileHandler as d}from"./fileHandler.js";import{converter as a}from"./converter.js";import{configManager as l}from"./configManager.js";import{quoteManager as o}from"./quoteManager.js";import{dialoguePreview as r}from"./dialoguePreview.js";import{batchProcessor as c}from"./batchProcessor.js";import{costumeManager as s}from"./costumeManager.js";function initializeApp(){bindClassicViewEvents(),bindSplitViewEvents(),bindViewSwitchEvents(),bindModalEvents(),d.setupFileDragDrop(),l.loadConfig(),s.loadCostumeConfig(),n(),i.initializeSplitResizer()}function bindClassicViewEvents(){document.getElementById("fileInput").addEventListener("change",d.handleFileUpload.bind(d)),document.getElementById("downloadBtn").addEventListener("click",d.downloadResult.bind(d)),document.getElementById("convertBtn").addEventListener("click",a.convertText.bind(a)),document.getElementById("formatTextBtn").addEventListener("click",i.formatText.bind(i)),document.getElementById("previewModeBtn").addEventListener("click",r.showDialoguePreview.bind(r)),document.getElementById("configBtn").addEventListener("click",l.openConfigModal.bind(l)),document.getElementById("addConfigBtn").addEventListener("click",l.addConfigItem.bind(l)),document.getElementById("saveConfigBtn").addEventListener("click",l.saveConfig.bind(l));let n=document.getElementById("resetConfigBtn");n&&n.addEventListener("click",l.resetConfig.bind(l));let E=document.getElementById("exportConfigBtn");E&&E.addEventListener("click",l.exportConfig.bind(l));let m=document.getElementById("importConfigBtn");m&&m.addEventListener("click",()=>{document.getElementById("importConfigInput").click()});let v=document.getElementById("importConfigInput");v&&v.addEventListener("change",e=>{let t=e.target.files[0];t&&(l.importConfig(t),e.target.value="")});let g=document.getElementById("enableLive2DCheckbox");g&&g.addEventListener("change",t=>{e.enableLive2D=t.target.checked,localStorage.setItem("bestdori_enable_live2d",t.target.checked.toString())});let B=document.getElementById("costumeConfigBtn");B&&B.addEventListener("click",s.openCostumeModal.bind(s));let p=document.getElementById("saveCostumesBtn");p&&p.addEventListener("click",s.saveCostumes.bind(s));let b=document.getElementById("resetCostumesBtn");b&&b.addEventListener("click",s.resetCostumes.bind(s)),document.getElementById("addCustomQuoteBtn").addEventListener("click",o.addCustomQuoteOption.bind(o)),document.getElementById("helpBtn").addEventListener("click",()=>t.openModal("helpModal")),document.getElementById("batchProcessBtn").addEventListener("click",c.openBatchModal.bind(c)),document.getElementById("batchFileInput").addEventListener("change",c.updateBatchFileList.bind(c)),document.getElementById("startBatchBtn").addEventListener("click",c.startBatchConversion.bind(c)),document.getElementById("downloadBatchResultBtn").addEventListener("click",c.handleBatchDownload.bind(c)),document.getElementById("inputText").addEventListener("input",i.syncTextAreas.bind(i)),document.getElementById("narratorName").addEventListener("input",e=>{document.getElementById("splitNarratorName").value=e.target.value})}function bindSplitViewEvents(){document.getElementById("formatTextSplitBtn").addEventListener("click",i.formatTextSplit.bind(i)),document.getElementById("splitConvertBtn").addEventListener("click",()=>{a.updateSplitPreview(!0)}),document.getElementById("splitDownloadBtn").addEventListener("click",d.downloadSplitResult.bind(d)),document.getElementById("autoPreviewCheckbox").addEventListener("change",t=>{e.autoPreviewEnabled=t.target.checked,e.autoPreviewEnabled&&a.updateSplitPreview()});let t=document.getElementById("splitEnableLive2DCheckbox");t&&(t.checked=e.enableLive2D,t.addEventListener("change",t=>{e.enableLive2D=t.target.checked,localStorage.setItem("bestdori_enable_live2d",t.target.checked.toString()),document.getElementById("enableLive2DCheckbox").checked=t.target.checked,e.autoPreviewEnabled&&i.debouncePreview()})),document.getElementById("splitQuoteConfigBtn").addEventListener("click",o.openSplitQuoteModal.bind(o)),document.getElementById("addSplitCustomQuoteBtn").addEventListener("click",o.addSplitCustomQuoteOption.bind(o)),document.getElementById("splitNarratorName").addEventListener("input",t=>{document.getElementById("narratorName").value=t.target.value,e.autoPreviewEnabled&&i.debouncePreview()}),document.getElementById("splitInputText").addEventListener("input",()=>{i.syncTextAreas(),i.debouncePreview()})}function bindViewSwitchEvents(){document.querySelectorAll(".view-btn").forEach(e=>{e.addEventListener("click",i.switchView.bind(i))}),document.querySelectorAll(".preview-mode-btn").forEach(e=>{e.addEventListener("click",i.switchPreviewMode.bind(i))})}function bindModalEvents(){}document.addEventListener("DOMContentLoaded",initializeApp);