import{state as e}from"./constants.js";import{ui as t,initGlobalModalListeners as n}from"./uiUtils.js";import{viewManager as i}from"./viewManager.js";import{fileHandler as d}from"./fileHandler.js";import{converter as o}from"./converter.js";import{configManager as l}from"./configManager.js";import{quoteManager as a}from"./quoteManager.js";import{dialoguePreview as r}from"./dialoguePreview.js";import{batchProcessor as s}from"./batchProcessor.js";import{costumeManager as c}from"./costumeManager.js";import{positionManager as E}from"./positionManager.js";function initializeApp(){bindClassicViewEvents(),bindSplitViewEvents(),bindViewSwitchEvents(),bindModalEvents(),E.init(),d.setupFileDragDrop(),l.loadConfig(),c.loadCostumeConfig(),n(),i.initializeSplitResizer()}function bindClassicViewEvents(){document.getElementById("fileInput").addEventListener("change",d.handleFileUpload.bind(d)),document.getElementById("downloadBtn").addEventListener("click",d.downloadResult.bind(d)),document.getElementById("convertBtn").addEventListener("click",o.convertText.bind(o)),document.getElementById("formatTextBtn").addEventListener("click",i.formatText.bind(i)),document.getElementById("previewModeBtn").addEventListener("click",r.showDialoguePreview.bind(r)),document.getElementById("configBtn").addEventListener("click",l.openConfigModal.bind(l)),document.getElementById("addConfigBtn").addEventListener("click",l.addConfigItem.bind(l)),document.getElementById("saveConfigBtn").addEventListener("click",l.saveConfig.bind(l)),document.getElementById("gotoBestdoriBtn").addEventListener("click",()=>{t.goToBestdori()});let n=document.getElementById("resetConfigBtn");n&&n.addEventListener("click",l.resetConfig.bind(l));let g=document.getElementById("exportConfigBtn");g&&g.addEventListener("click",l.exportConfig.bind(l));let m=document.getElementById("importConfigBtn");m&&m.addEventListener("click",()=>{document.getElementById("importConfigInput").click()});let v=document.getElementById("importConfigInput");v&&v.addEventListener("change",e=>{let t=e.target.files[0];t&&(l.importConfig(t),e.target.value="")});let B=document.getElementById("enableLive2DCheckbox");B&&B.addEventListener("change",t=>{e.enableLive2D=t.target.checked,localStorage.setItem("bestdori_enable_live2d",t.target.checked.toString());let n=document.getElementById("positionConfigBtn");n&&(n.disabled=!t.target.checked)});let p=document.getElementById("positionConfigBtn");p&&p.addEventListener("click",()=>{E.openPositionModal()});let b=document.getElementById("costumeConfigBtn");b&&b.addEventListener("click",c.openCostumeModal.bind(c));let u=document.getElementById("saveCostumesBtn");u&&u.addEventListener("click",c.saveCostumes.bind(c));let I=document.getElementById("resetCostumesBtn");I&&I.addEventListener("click",c.resetCostumes.bind(c)),document.getElementById("addCustomQuoteBtn").addEventListener("click",a.addCustomQuoteOption.bind(a)),document.getElementById("helpBtn").addEventListener("click",()=>t.openModal("helpModal")),document.getElementById("batchProcessBtn").addEventListener("click",s.openBatchModal.bind(s)),document.getElementById("batchFileInput").addEventListener("change",s.updateBatchFileList.bind(s)),document.getElementById("startBatchBtn").addEventListener("click",s.startBatchConversion.bind(s)),document.getElementById("downloadBatchResultBtn").addEventListener("click",s.handleBatchDownload.bind(s)),document.getElementById("inputText").addEventListener("input",i.syncTextAreas.bind(i)),document.getElementById("narratorName").addEventListener("input",e=>{document.getElementById("splitNarratorName").value=e.target.value})}function bindSplitViewEvents(){document.getElementById("formatTextSplitBtn").addEventListener("click",i.formatTextSplit.bind(i)),document.getElementById("splitConvertBtn").addEventListener("click",()=>{o.updateSplitPreview(!0)}),document.getElementById("splitDownloadBtn").addEventListener("click",d.downloadSplitResult.bind(d)),document.getElementById("autoPreviewCheckbox").addEventListener("change",t=>{e.autoPreviewEnabled=t.target.checked,e.autoPreviewEnabled&&o.updateSplitPreview()}),document.getElementById("splitGotoBestdoriBtn").addEventListener("click",()=>{t.goToBestdori()});let n=document.getElementById("splitEnableLive2DCheckbox");n&&(n.checked=e.enableLive2D,n.addEventListener("change",t=>{e.enableLive2D=t.target.checked,localStorage.setItem("bestdori_enable_live2d",t.target.checked.toString()),document.getElementById("enableLive2DCheckbox").checked=t.target.checked,e.autoPreviewEnabled&&i.debouncePreview()})),document.getElementById("splitQuoteConfigBtn").addEventListener("click",a.openSplitQuoteModal.bind(a)),document.getElementById("addSplitCustomQuoteBtn").addEventListener("click",a.addSplitCustomQuoteOption.bind(a)),document.getElementById("splitNarratorName").addEventListener("input",t=>{document.getElementById("narratorName").value=t.target.value,e.autoPreviewEnabled&&i.debouncePreview()}),document.getElementById("splitInputText").addEventListener("input",()=>{i.syncTextAreas(),i.debouncePreview()})}function bindViewSwitchEvents(){document.querySelectorAll(".view-btn").forEach(e=>{e.addEventListener("click",i.switchView.bind(i))}),document.querySelectorAll(".preview-mode-btn").forEach(e=>{e.addEventListener("click",i.switchPreviewMode.bind(i))})}function bindModalEvents(){}document.addEventListener("DOMContentLoaded",initializeApp);