export class ResultCache{constructor(e=50,t=3e5){this.cache=new Map,this.maxSize=e,this.maxAge=t,this.accessOrder=[]}generateKey(e,t){let s=JSON.stringify({narrator:t.narratorName,quotes:t.selectedQuotePairs,mapping:t.characterMapping,live2d:t.enableLive2D,costume:t.costumeMapping,position:t.positionConfig});return this.simpleHash(e+s)}simpleHash(e){let t=0;for(let s=0;s<e.length;s++){let i=e.charCodeAt(s);t=(t<<5)-t+i,t&=t}return t.toString(36)}set(e,t){if(this.cache.has(e)){this.cache.delete(e);let s=this.accessOrder.indexOf(e);s>-1&&this.accessOrder.splice(s,1)}if(this.cache.size>=this.maxSize){let i=this.accessOrder.shift();this.cache.delete(i)}this.cache.set(e,{value:t,timestamp:Date.now(),size:JSON.stringify(t).length}),this.accessOrder.push(e)}get(e){let t=this.cache.get(e);if(!t)return null;if(Date.now()-t.timestamp>this.maxAge)return this.delete(e),null;let s=this.accessOrder.indexOf(e);return s>-1&&(this.accessOrder.splice(s,1),this.accessOrder.push(e)),t.value}delete(e){this.cache.delete(e);let t=this.accessOrder.indexOf(e);t>-1&&this.accessOrder.splice(t,1)}clear(){this.cache.clear(),this.accessOrder=[]}getStats(){let e=0,t=Date.now();return this.cache.forEach(s=>{e+=s.size,s.timestamp<t&&(t=s.timestamp)}),{count:this.cache.size,totalSize:e,oldestAge:Date.now()-t,hitRate:this.calculateHitRate()}}calculateHitRate(){return this.requests||(this.requests=0),this.hits||(this.hits=0),this.requests>0?(this.hits/this.requests*100).toFixed(2)+"%":"0%"}}export class PreviewCache extends ResultCache{constructor(){super(30,6e5)}generatePreviewKey(e,t){let s={narrator:t.narratorName,quotes:t.selectedQuotePairs,live2d:t.enableLive2D},i=this.quickHash(e),r=this.quickHash(JSON.stringify(s));return`${i}-${r}`}quickHash(e){return e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0).toString(36)}}